---
import Layout from "../../layouts/Layout.astro";

// Fetch events from Google Calendar on the server
const calendarId = import.meta.env.CALENDAR_ID;
const apiKey = import.meta.env.GOOGLE_CALENDAR_API_KEY;

const googleCalendarUrl = `https://www.googleapis.com/calendar/v3/calendars/${calendarId}/events?key=${apiKey}`;

let events = [];

try {
  const response = await fetch(googleCalendarUrl);
  const data = await response.json();

  if (data.items) {
    events = data.items; // Directly pass the entire events array
  } else {
    console.error("No events found");
  }
} catch (error) {
  console.error("Error fetching events:", error);
}
---

<Layout title="Google Calendar">
  <section id="calendar-section">
    <div id="calendar"></div>
    <noscript>Calendar could not load. Please enable JavaScript.</noscript>
    <p id="error-message" style="color: red;"></p>
  </section>
</Layout>

<!-- Define the events data globally for the client-side script -->
<script define:vars={{ events }} is:inline>
  window.events = events;
</script>

<!-- Load the external calendar.ts script -->
<script src="/scripts/fullCalendar.ts" type="module" is:inline></script>
