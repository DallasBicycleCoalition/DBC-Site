---
import { getLayout } from "../utils/groqQueries";
import { urlFor } from "../utils/utils";

const data = await getLayout();
---

<header>
  <a href={data?.landingPageLink || "/"}>
    {
      data?.logo && data.logo.asset && (
        <img
          src={urlFor(data.logo.asset).url()}
          alt={data.logo.altText || "Logo"}
        />
      )
    }
  </a>
  <button id="menuToggle" aria-label="Toggle navigation">&#9776;</button>
  <nav id="navMenu">
    <a href="/calendar">Calendar</a>
    <a href="/weekWithoutDriving">Week Without Driving</a>
  </nav>
</header>

<script is:inline type="module">
  function toggleMenu(menuToggle, navMenu) {
    console.log("Toggling menu");
    navMenu.classList.toggle("active");
    menuToggle.classList.toggle("active");
    menuToggle.innerHTML = navMenu.classList.contains("active")
      ? "&#10005;"
      : "&#9776;";
  }

  function init() {
    console.log("Initializing navigation menu");
    const menuToggle = document.getElementById("menuToggle");
    const navMenu = document.getElementById("navMenu");

    if (menuToggle && navMenu) {
      const handleClick = () => toggleMenu(menuToggle, navMenu);
      menuToggle.addEventListener("click", handleClick);

      document.addEventListener(
        "astro:before-swap",
        (event) => {
          console.log("Before page swap: Cleaning up event listeners", event);
          menuToggle.removeEventListener("click", handleClick);
        },
        { once: true }
      );
    } else {
      console.error("Menu toggle button or navigation menu is missing.");
    }
  }

  // Initialize on first load
  init();

  // Re-initialize after swapping pages
  document.addEventListener("astro:after-swap", (event) => {
    console.log("After page swap: Reinitializing navigation", event);
    init();
  });
</script>
